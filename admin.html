<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Painel TV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      margin-top: 0;
    }
    section {
      background: #1e1e1e;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-size: 14px;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border-radius: 4px;
      border: none;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
    }
    button {
      background: #16a34a;
      color: #fff;
      cursor: pointer;
      margin-top: 15px;
    }
    button.danger {
      background: #dc2626;
    }
    .slide-item {
      border: 1px solid #333;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
    }
  </style>
</head>
<body>

<h1>Admin â€“ Painel TV</h1>

<section>
  <h2>ConfiguraÃ§Ãµes Gerais</h2>

  <label>Nome da Escola
    <input id="schoolName" />
  </label>

  <label>Texto do RodapÃ©
    <input id="tickerText" />
  </label>

  <label>Cor PrimÃ¡ria
    <input type="color" id="primaryColor" />
  </label>

  <label>Cor de Destaque
    <input type="color" id="accentColor" />
  </label>

  <label>Zoom do Texto
    <input type="number" step="0.1" id="zoom" />
  </label>

  <label>EspaÃ§amento Separador
    <input type="number" id="separatorSpacing" />
  </label>
</section>

<section>
  <h2>Slides</h2>
  <div id="slides"></div>
  <button onclick="addSlide()">âž• Adicionar Slide</button>
</section>

<button onclick="publish()">ðŸ’¾ Publicar no GitHub</button>

<script>
const GITHUB = {
  owner: "SEU_USUARIO",
  repo: "SEU_REPOSITORIO",
  path: "data.json",
  token: "SEU_TOKEN_FINE_GRAINED"
};

let DATA = {};
let FILE_SHA = null;

async function loadData() {
  const res = await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}`);
  const json = await res.json();

  FILE_SHA = json.sha;
  DATA = JSON.parse(atob(json.content));

  document.getElementById("schoolName").value = DATA.schoolName || "";
  document.getElementById("tickerText").value = DATA.tickerText || "";
  document.getElementById("primaryColor").value = DATA.primaryColor || "#000000";
  document.getElementById("accentColor").value = DATA.accentColor || "#ffffff";
  document.getElementById("zoom").value = Number(DATA.zoom || 1);
  document.getElementById("separatorSpacing").value = Number(DATA.separatorSpacing || 2);

  renderSlides();
}

function renderSlides() {
  const container = document.getElementById("slides");
  container.innerHTML = "";

  DATA.slides.forEach((s, i) => {
    const div = document.createElement("div");
    div.className = "slide-item";

    div.innerHTML = `
      <label>TÃ­tulo
        <input value="${s.title || ""}" onchange="DATA.slides[${i}].title=this.value">
      </label>
      <label>Mensagem
        <textarea onchange="DATA.slides[${i}].message=this.value">${s.message || ""}</textarea>
      </label>
      <label>Categoria
        <input value="${s.category || ""}" onchange="DATA.slides[${i}].category=this.value">
      </label>
      <label>Tipo de MÃ­dia
        <select onchange="DATA.slides[${i}].mediaType=this.value">
          <option value="image" ${s.mediaType==="image"?"selected":""}>Imagem</option>
          <option value="video" ${s.mediaType==="video"?"selected":""}>VÃ­deo</option>
          <option value="iframe" ${s.mediaType==="iframe"?"selected":""}>Iframe</option>
        </select>
      </label>
      <label>URL da MÃ­dia
        <input value="${s.url || ""}" onchange="DATA.slides[${i}].url=this.value">
      </label>
      <label>DuraÃ§Ã£o (segundos)
        <input type="number" value="${s.duration || 10}" onchange="DATA.slides[${i}].duration=Number(this.value)">
      </label>
      <button class="danger" onclick="removeSlide(${i})">Excluir</button>
    `;

    container.appendChild(div);
  });
}

function addSlide() {
  DATA.slides.push({
    id: Date.now(),
    category: "",
    title: "",
    message: "",
    layout: "default",
    mediaType: "image",
    url: "",
    duration: 10,
    startDate: null,
    endDate: null
  });
  renderSlides();
}

function removeSlide(i) {
  DATA.slides.splice(i, 1);
  renderSlides();
}

async function publish() {
  DATA.schoolName = document.getElementById("schoolName").value;
  DATA.tickerText = document.getElementById("tickerText").value;
  DATA.primaryColor = document.getElementById("primaryColor").value;
  DATA.accentColor = document.getElementById("accentColor").value;
  DATA.zoom = Number(document.getElementById("zoom").value);
  DATA.separatorSpacing = Number(document.getElementById("separatorSpacing").value);

  const content = btoa(unescape(encodeURIComponent(JSON.stringify(DATA, null, 2))));

  await fetch(`https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${GITHUB.path}`, {
    method: "PUT",
    headers: {
      "Authorization": "token " + GITHUB.token,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      message: "AtualizaÃ§Ã£o do painel",
      content,
      sha: FILE_SHA
    })
  });

  alert("Publicado com sucesso!");
}

loadData();
</script>

</body>
</html>
